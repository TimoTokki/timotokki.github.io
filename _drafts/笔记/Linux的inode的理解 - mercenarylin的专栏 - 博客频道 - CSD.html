<html>
<head>
  <title>Linux的inode的理解 - mercenarylin的专栏 - 博客频道 - CSDN.NET</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/275193; Windows/6.3.9600;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="14412"/>
<h1>Linux的inode的理解 - mercenarylin的专栏 - 博客频道 - CSDN.NET</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2016/1/15 23:28</i></td></tr>
<tr><td><b>标签：</b></td><td><i>IT</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://blog.csdn.net/mercenarylin/article/details/19994525"><i>http://blog.csdn.net/mercenarylin/article/details/19994525</i></a></td></tr>
</table>
</div>
<br/>

<div><span><br/><div style="font-size: 16px"><div><div style="font-size:12px;font-family:Arial, Console, Verdana, 'Courier New';background:url(&quot;http://static.blog.csdn.net/skin/light_blue/css/../images/body_bg.jpg&quot;) 50% 0% repeat-x;"><div style="background:url(&quot;http://static.blog.csdn.net/skin/light_blue/css/../images/head_bg.jpg&quot;) 50% -25px no-repeat;"><div style="text-align:left;"><div style="overflow:hidden;"><div style="background:rgb(255, 255, 255);"><div><div style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:14px;line-height:26px;font-family:Arial;"><div style="top:0px;"><p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">文件名 -&gt; inode -&gt; device block </p>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
转自：<br style="margin:0px;padding:0px;"/>
<a href="http://www.ruanyifeng.com/blog/2011/12/inode.html" style="color:green;text-decoration:none;margin:0px;padding:1px 3px;" target="_blank">http://www.ruanyifeng.com/blog/2011/12/inode.html</a><br style="margin:0px;padding:0px;"/>
<a href="http://blog.s135.com/post/295/" style="color:green;text-decoration:none;margin:0px;padding:1px 3px;" target="_blank">http://blog.s135.com/post/295/</a> <br style="margin:0px;padding:0px;"/>
<a href="http://hi.baidu.com/leejun_2005/blog/item/d9aa13a53b3af6e99152ee7e.html" style="color:green;text-decoration:none;margin:0px;padding:1px 3px;" target="_blank">http://hi.baidu.com/leejun_2005/blog/item/d9aa13a53b3af6e99152ee7e.html</a> <br style="margin:0px;padding:0px;"/>
</p>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
一、inode是什么？</p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
理解inode，要从文件储存说起。</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
文件储存在硬盘上，硬盘的最小存储单位叫做&quot;扇区&quot;（Sector）。每个扇区储存512字节（相当于0.5KB）。</div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
操作系统读取硬盘的时候，不会一个个扇区地读取，这样效率太低，而是一次性连续读取多个扇区，即一次性读取一个&quot;块&quot;（block）。这种由多个扇区组成的&quot;块&quot;，是文件存取的最小单位。&quot;块&quot;的大小，最常见的是4KB，即连续八个 sector组成一个 block。</div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
文件数据都储存在&quot;块&quot;中，那么很显然，我们还必须找到一个地方储存文件的元信息，比如文件的创建者、文件的创建日期、文件的大小等等。这种储存文件元信息的区域就叫做inode，中文译名为&quot;索引节点&quot;。</div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
二、inode的内容</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
inode包含文件的元信息，具体来说有以下内容：</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
　　* 文件的字节数</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
　　* 文件拥有者的User ID</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
　　* 文件的Group ID</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
　　* 文件的读、写、执行权限</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
　　* 文件的时间戳，共有三个：ctime指inode上一次变动的时间，mtime指文件内容上一次变动的时间，atime指文件上一次打开的时间。</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
　　* 链接数，即有多少文件名指向这个inode</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
　　* 文件数据block的位置</div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
可以用stat命令，查看某个文件的inode信息：</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
stat example.txt</div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
<br style="margin:0px;padding:0px;"/>
</p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
总之，除了文件名以外的所有文件信息，都存在inode之中。至于为什么没有文件名，下文会有详细解释。</div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
三、inode的大小</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
inode也会消耗硬盘空间，所以硬盘格式化的时候，操作系统自动将硬盘分成两个区域。一个是数据区，存放文件数据；另一个是inode区（inode table），存放inode所包含的信息。</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
每个inode节点的大小，一般是128字节或256字节。inode节点的总数，在格式化时就给定，一般是每1KB或每2KB就设置一个inode。假定在一块1GB的硬盘中，每个inode节点的大小为128字节，每1KB就设置一个inode，那么inode table的大小就会达到128MB，占整块硬盘的12.8%。</div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
查看每个硬盘分区的inode总数和已经使用的数量，可以使用df命令。</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
df -i</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
查看每个inode节点的大小，可以用如下命令：</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
sudo dumpe2fs -h /dev/hda | grep &quot;Inode size&quot;</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
由于每个文件都必须有一个inode，因此有可能发生inode已经用光，但是硬盘还未存满的情况。这时，就无法在硬盘上创建新文件。</div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
四、inode号码</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
每个inode都有一个号码，操作系统用inode号码来识别不同的文件。</div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
这里值得重复一遍，Unix/Linux系统内部不使用文件名，而使用inode号码来识别文件。对于系统来说，文件名只是inode号码便于识别的别称或者绰号。表面上，用户通过文件名，打开文件。实际上，系统内部这个过程分成三步：首先，系统找到这个文件名对应的inode号码；其次，通过inode号码，获取inode信息；最后，根据inode信息，找到文件数据所在的block，读出数据。</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
使用ls -i命令，可以看到文件名对应的inode号码：</p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
ls -i example.txt</div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
五、目录文件</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
Unix/Linux系统中，目录（directory）也是一种文件。打开目录，实际上就是打开目录文件。</div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
目录文件的结构非常简单，就是一系列目录项（dirent）的列表。每个目录项，由两部分组成：所包含文件的文件名，以及该文件名对应的inode号码。</div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
ls命令只列出目录文件中的所有文件名：</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
ls /etc</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
ls -i命令列出整个目录文件，即文件名和inode号码：</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
ls -i /etc</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
如果要查看文件的详细信息，就必须根据inode号码，访问inode节点，读取信息。ls -l命令列出文件的详细信息。</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
ls -l /etc</div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
六、硬链接</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
一般情况下，文件名和inode号码是&quot;一一对应&quot;关系，每个inode号码对应一个文件名。但是，Unix/Linux系统允许，多个文件名指向同一个inode号码。这意味着，可以用不同的文件名访问同样的内容；对文件内容进行修改，会影响到所有文件名；但是，删除一个文件名，不影响另一个文件名的访问。这种情况就被称为&quot;硬链接&quot;（hard link）。</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
ln命令可以创建硬链接：</p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
ln 源文件 目标文件</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
运行上面这条命令以后，源文件与目标文件的inode号码相同，都指向同一个inode。inode信息中有一项叫做&quot;链接数&quot;，记录指向该inode的文件名总数，这时就会增加1。反过来，删除一个文件名，就会使得inode节点中的&quot;链接数&quot;减1。当这个值减到0，表明没有文件名指向这个inode，系统就会回收这个inode号码，以及其所对应block区域。</div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
这里顺便说一下目录文件的&quot;链接数&quot;。创建目录时，默认会生成两个目录项：&quot;.&quot;和&quot;..&quot;。前者的inode号码就是当前目录的inode号码，等同于当前目录的&quot;硬链接&quot;；后者的inode号码就是当前目录的父目录的inode号码，等同于父目录的&quot;硬链接&quot;。所以，任何一个目录的&quot;硬链接&quot;总数，总是等于2加上它的子目录总数（含隐藏目录）,这里的2是父目录对其的“硬链接”和当前目录下的&quot;.硬链接“。</div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
七、软链接</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
除了硬链接以外，还有一种特殊情况。文件A和文件B的inode号码虽然不一样，但是文件A的内容是文件B的路径。读取文件A时，系统会自动将访问者导向文件B。因此，无论打开哪一个文件，最终读取的都是文件B。这时，文件A就称为文件B的&quot;软链接&quot;（soft link）或者&quot;符号链接（symbolic link）。</div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
这意味着，文件A依赖于文件B而存在，如果删除了文件B，打开文件A就会报错：&quot;No such file or directory&quot;。这是软链接与硬链接最大的不同：文件A指向文件B的文件名，而不是文件B的inode号码，文件B的inode&quot;链接数&quot;不会因此发生变化。</div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
ln -s命令可以创建软链接。</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
ln -s 源文文件或目录 目标文件或目录</div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
八、inode的特殊作用</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
由于inode号码与文件名分离，这种机制导致了一些Unix/Linux系统特有的现象。</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
　　1. 有时，文件名包含特殊字符，无法正常删除。这时，直接删除inode节点，就能起到删除文件的作用。</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
　　2. 移动文件或重命名文件，只是改变文件名，不影响inode号码。</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
　　3. 打开一个文件以后，系统就以inode号码来识别这个文件，不再考虑文件名。因此，通常来说，系统无法从inode号码得知文件名。</div>
<div style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
      第3点使得软件更新变得简单，可以在不关闭软件的情况下进行更新，不需要重启。因为系统通过inode号码，识别运行中的文件，不通过文件名。更新的时候，新版文件以同样的文件名，生成一个新的inode，不会影响到运行中的文件。等到下一次运行这个软件的时候，文件名就自动指向新版文件，旧版文件的inode则被回收。</div>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
九 实际问题</p>
<span style="margin:0px;padding:0px;font-family:Tahoma,Arial;background-color:rgb(234,239,240);">在一台配置较低的Linux服务器（内存、硬盘比较小）的/data分区内创建文件时，系统提示磁盘空间不足，用df -h命令查看了一下磁盘使用情况，发现/data分区只使用了66%，还有12G的剩余空间，按理说不会出现这种问题。</span><span style="font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;"> </span><span style="margin:0px;padding:0px;font-family:Tahoma,Arial;background-color:rgb(234,239,240);">后来用df
 -i查看了一下/data分区的索引节点(inode)，发现已经用满(IUsed=100%)，导致系统无法创建新目录和文件。</span><span style="font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;"> </span><br style="margin:0px;padding:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;"/>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<span style="margin:0px;padding:0px;font-family:Tahoma,Arial;background-color:rgb(234,239,240);">查找原因：</span><br style="margin:0px;padding:0px;font-family:Tahoma,Arial;background-color:rgb(234,239,240);"/>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
<span style="margin:0px;padding:0px;font-family:Tahoma,Arial;font-size:12px;line-height:normal;background-color:rgb(234,239,240);">　　/data/cache目录中存在数量非常多的小字节缓存文件，占用的Block不多，但是占用了大量的inode。</span> </p>
<p style="margin:10px auto;padding:0px;padding-top:0px;padding-bottom:0px;font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;">
 </p>
<span style="margin:0px;padding:0px;font-family:Tahoma,Arial;background-color:rgb(234,239,240);">解决方案：</span><br style="margin:0px;padding:0px;font-family:Tahoma,Arial;background-color:rgb(234,239,240);"/>
<span style="margin:0px;padding:0px;font-family:Tahoma,Arial;background-color:rgb(234,239,240);">　　1、删除/data/cache目录中的部分文件，释放出/data分区的一部分inode。</span><br style="margin:0px;padding:0px;font-family:Tahoma,Arial;background-color:rgb(234,239,240);"/>
<span style="margin:0px;padding:0px;font-family:Tahoma,Arial;background-color:rgb(234,239,240);">　　2、用软连接将空闲分区/opt中的newcache目录连接到/data/cache，使用/opt分区的inode来缓解/data分区inode不足的问题：</span><br style="margin:0px;padding:0px;font-family:Tahoma,Arial;background-color:rgb(234,239,240);"/>
<span style="margin:0px;padding:0px;font-family:Tahoma,Arial;background-color:rgb(234,239,240);">　　</span><span style="margin:0px;padding:0px;font-family:Tahoma,Arial;background-color:rgb(234,239,240);color:rgb(0,128,0);">ln -s /opt/newcache /data/cache</span><span style="font-family:Verdana,Arial,Helvetica,sans-serif;font-size:13.920000076293945px;line-height:20px;"> </span>文件名
 -&gt; inode -&gt; device block </div></div></div></div></div></div></div></div></div></div><br/></span>
</div></body></html> 