<html>
<head>
  <title>unix文件和目录操作的函数stat（）、fstat（）、lstat（）、access（）、umask（）函数 - liangxanhai的专栏 - 博客频道 - CSDN.NET</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/275193; Windows/6.3.9600;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="14415"/>
<h1>unix文件和目录操作的函数stat（）、fstat（）、lstat（）、access（）、umask（）函数 - liangxanhai的专栏 - 博客频道 - CSDN.NET</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2016/1/15 23:33</i></td></tr>
<tr><td><b>标签：</b></td><td><i>IT, 减藏</i></td></tr>
<tr><td><b>来源：</b></td><td><a href="http://blog.csdn.net/liangxanhai/article/details/7755341"><i>http://blog.csdn.net/liangxanhai/article/details/7755341</i></a></td></tr>
</table>
</div>
<br/>

<div><span><br/><div style="font-size: 16px"><div><div style="color:rgb(51, 51, 51);text-align:center;font-size:12px;font-family:Arial, Console, Verdana, 'Courier New';background:url(&quot;http://static.blog.csdn.net/skin/default/css/../images/body_bg.gif&quot;) 0px 20px repeat-x;"><div style="background:url(&quot;http://static.blog.csdn.net/skin/default/css/../images/head_bg.jpg&quot;) 50% 0% no-repeat;"><div style="overflow:hidden;border-radius:8px;text-align:left;background:rgb(255, 255, 255);"><div style="overflow:hidden;border-radius:4px;"><div><div><div style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:14px;line-height:26px;font-family:Arial;">

<p><span style="font-size:18px;">（1）stat（）函数：通过文件名filename来获取文件的属性值</span></p>
<p><span style="font-size:18px;"><span style="font-family:Arial;line-height:26px;text-align:left;">表头文件:    #include &lt;sys/stat.h&gt;<br/>
</span><span style="font-family:Arial;line-height:26px;text-align:left;">                   #include &lt;unistd.h&gt;<br/>
定义函数:    </span><span style="font-family:Arial;line-height:26px;text-align:left;">int stat(const char *file_name, struct stat *buf);<br/>
函数说明:    </span><span style="font-family:Arial;line-height:26px;text-align:left;">通过文件名filename获取文件信息，并保存在buf所指的结构体stat中<br/>
返回值:     </span><span style="font-family:Arial;line-height:26px;text-align:left;">执行成功则返回0，失败返回-1，错误代码存于errno</span></span><br/>
</p>
<p><span style="font-size:18px;"><span style="font-family:Arial;line-height:26px;text-align:left;">结构体stat相关的内容：</span></span></p>
<p><span style="font-size:18px;"><span style="font-family:Arial;line-height:26px;text-align:left;"><span style="font-family:Arial;line-height:26px;text-align:left;">struct stat {</span><br style="font-family:Arial;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;line-height:26px;text-align:left;">    dev_t         st_dev;       //文件的设备编号</span><br style="font-family:Arial;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;line-height:26px;text-align:left;">    ino_t         st_ino;       //节点</span><br style="font-family:Arial;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;line-height:26px;text-align:left;">    mode_t        st_mode;      //文件的类型和存取的权限（该属性下面包含很多宏来处理文件的类型以及文件的存取权限）</span><br style="font-family:Arial;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;line-height:26px;text-align:left;">    nlink_t       st_nlink;     //连到该文件的硬连接数目，刚建立的文件值为1</span><br style="font-family:Arial;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;line-height:26px;text-align:left;">    uid_t         st_uid;       //用户ID</span><br style="font-family:Arial;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;line-height:26px;text-align:left;">    gid_t         st_gid;       //组ID</span><br style="font-family:Arial;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;line-height:26px;text-align:left;">    dev_t         st_rdev;      //(设备类型)若此文件为设备文件，则为其设备编号</span><br style="font-family:Arial;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;line-height:26px;text-align:left;">    off_t         st_size;      //文件字节数(文件大小)</span><br style="font-family:Arial;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;line-height:26px;text-align:left;">    unsigned long st_blksize;   //块大小(文件系统的I/O 缓冲区大小)</span><br style="font-family:Arial;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;line-height:26px;text-align:left;">    unsigned long st_blocks;    //块数</span><br style="font-family:Arial;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;line-height:26px;text-align:left;">    time_t        st_atime;     //最后一次访问时间</span><br style="font-family:Arial;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;line-height:26px;text-align:left;">    time_t        st_mtime;     //最后一次修改时间</span><br style="font-family:Arial;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;line-height:26px;text-align:left;">    time_t        st_ctime;     //最后一次改变时间(指属性)</span><br style="font-family:Arial;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;line-height:26px;text-align:left;">};</span><br/>
</span></span></p>
<p><span style="font-size:18px;"><span style="font-family:Arial;line-height:26px;text-align:left;"><span style="font-family:Arial;line-height:26px;text-align:left;">例子：</span></span></span></p>
<p><span style="font-size:18px;"><span style="font-family:Arial;line-height:26px;text-align:left;"><span style="font-family:Arial;line-height:26px;text-align:left;"><span style="font-family:Arial;font-size:10px;line-height:26px;text-align:left;">#include
 &lt;sys/stat.h&gt;</span><br style="font-family:Arial;font-size:10px;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;font-size:10px;line-height:26px;text-align:left;">#include &lt;unistd.h&gt;</span><br style="font-family:Arial;font-size:10px;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;font-size:10px;line-height:26px;text-align:left;">#include &lt;stdio.h&gt;</span><br style="font-family:Arial;font-size:10px;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;font-size:10px;line-height:26px;text-align:left;">int main() {</span><br style="font-family:Arial;font-size:10px;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;font-size:10px;line-height:26px;text-align:left;">    struct stat buf;</span><br style="font-family:Arial;font-size:10px;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;font-size:10px;line-height:26px;text-align:left;">    </span><span style="font-family:Arial;font-size:10px;line-height:26px;text-align:left;color:rgb(128,0,0);"><strong>stat(&quot;/etc/hosts&quot;, &amp;buf)</strong></span><span style="font-family:Arial;font-size:10px;line-height:26px;text-align:left;">;</span><br style="font-family:Arial;font-size:10px;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;font-size:10px;line-height:26px;text-align:left;">    printf(&quot;/etc/hosts file size = %d/n&quot;, </span><span style="font-family:Arial;font-size:10px;line-height:26px;text-align:left;color:rgb(128,0,0);"><strong>buf.st_size</strong></span><span style="font-family:Arial;font-size:10px;line-height:26px;text-align:left;">);</span><br style="font-family:Arial;font-size:10px;line-height:26px;text-align:left;"/>
<span style="font-family:Arial;font-size:10px;line-height:26px;text-align:left;">}</span><br/>
</span></span></span></p>
<p><span style="font-family:Arial;line-height:26px;text-align:left;"><span style="font-family:Arial;line-height:26px;text-align:left;"><span style="font-family:Arial;line-height:26px;text-align:left;"><span style="font-size:18px;">(2)fstat()函数：由文件描述符来获取文件的属性</span></span></span></span></p>
<p><span style="line-height:26px;text-align:left;"><span style="line-height:26px;text-align:left;"><span style="line-height:26px;text-align:left;"><strong><span style="color:rgb(102,102,102);font-family:'AR PL UKai CN';font-size:16px;">相关函数 stat，lstat，chmod，chown，readlink，utime</span><br style="color:rgb(102,102,102);font-family:'AR PL UKai CN';font-size:16px;"/>
<span style="color:rgb(102,102,102);font-family:'AR PL UKai CN';font-size:16px;">表头文件 #include&lt;sys/stat.h&gt;</span><br style="color:rgb(102,102,102);font-family:'AR PL UKai CN';font-size:16px;"/>
<span style="color:rgb(102,102,102);font-family:'AR PL UKai CN';font-size:16px;">#include&lt;unistd.h&gt;</span><br style="color:rgb(102,102,102);font-family:'AR PL UKai CN';font-size:16px;"/>
<span style="color:rgb(102,102,102);font-family:'AR PL UKai CN';font-size:16px;">定义函数 int fstat(int fildes,struct stat *buf);（stat的说明如上）</span><br style="color:rgb(102,102,102);font-family:'AR PL UKai CN';font-size:16px;"/>
<span style="color:rgb(102,102,102);font-family:'AR PL UKai CN';font-size:16px;">函数说明 fstat()用来将参数fildes所指的文件状态，复制到参数buf所指的</span><br style="color:rgb(102,102,102);font-family:'AR PL UKai CN';font-size:16px;"/>
<span style="color:rgb(102,102,102);font-family:'AR PL UKai CN';font-size:16px;">结构中(struct stat)。Fstat()与stat()作用完全相同，不同处在</span><br style="color:rgb(102,102,102);font-family:'AR PL UKai CN';font-size:16px;"/>
<span style="color:rgb(102,102,102);font-family:'AR PL UKai CN';font-size:16px;">于传入的参数为已打开的文件描述词。详细内容请参考stat()。</span><br style="color:rgb(102,102,102);font-family:'AR PL UKai CN';font-size:16px;"/>
<span style="color:rgb(102,102,102);font-family:'AR PL UKai CN';font-size:16px;">返回值 执行成功则返回0，失败返回-1。</span><br/>
</strong></span></span></span></p>
<p><span style="line-height:26px;text-align:left;"><span style="line-height:26px;text-align:left;"><span style="line-height:26px;text-align:left;"><strong><span style="color:rgb(102,102,102);font-family:'AR PL UKai CN';font-size:16px;">（3）</span><span style="font-family:'AR PL UKai CN';"><span style="font-size:18px;">lstat（）函数：根据文件名来获取文件的属性</span></span></strong></span></span></span></p>
<p><span style="line-height:26px;text-align:left;"><span style="line-height:26px;text-align:left;"><span style="line-height:26px;text-align:left;"><span style="font-weight:bold;"><span style="font-family:'AR PL UKai CN';"><span style="font-size:18px;"><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;text-align:left;">函数原型：int
 lstat(const char *path, struct stat *buf);</span></span></span></span></span></span></span></p>
<p><span style="line-height:26px;text-align:left;"><span style="line-height:26px;text-align:left;"><span style="line-height:26px;text-align:left;"><span style="font-weight:bold;"><span style="font-family:'AR PL UKai CN';"><span style="font-size:18px;"><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;text-align:left;">该函数类似于stat函数，但是当文件是一个符号链接的时候lstat返回该符号链接的有关信息，而不是由该符号链接引用的文件的信息。 </span><br/>
</span></span></span></span></span></span></p>
<p><span style="line-height:26px;text-align:left;"><span style="line-height:26px;text-align:left;"><span style="line-height:26px;text-align:left;"><span style="font-weight:bold;"><span style="font-family:'AR PL UKai CN';"><span style="font-size:18px;"><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;text-align:left;">（4）access（）函数：检查文件可以执行某种操作</span></span></span></span></span></span></span></p>
<p><span style="font-family:Arial;line-height:26px;text-align:left;"><span style="font-size:18px;"><span style="font-family:arial;line-height:22px;text-align:left;">功能描述：</span> <br style="font-family:arial;text-align:left;"/>
<span style="font-family:arial;line-height:22px;text-align:left;">检查调用进程是否可以对指定的文件执行某种操作。</span> <br style="font-family:arial;text-align:left;"/>
<span style="font-family:arial;line-height:22px;text-align:left;">用法：</span> <br style="font-family:arial;text-align:left;"/>
<span style="font-family:arial;line-height:22px;text-align:left;">#include &lt;unistd.h&gt;</span><br style="font-family:arial;text-align:left;"/>
<span style="font-family:arial;line-height:22px;text-align:left;">#include &lt;fcntl.h&gt;</span><br style="font-family:arial;text-align:left;"/>
<span style="font-family:arial;line-height:22px;text-align:left;">int access(const char *pathname, int mode); </span><br style="font-family:arial;text-align:left;"/>
<span style="font-family:arial;line-height:22px;text-align:left;">参数：</span> <br style="font-family:arial;text-align:left;"/>
<span style="font-family:arial;line-height:22px;text-align:left;">pathname: 需要测试的文件路径名。 </span><br style="font-family:arial;text-align:left;"/>
<span style="font-family:arial;line-height:22px;text-align:left;">mode: 需要测试的操作模式，可能值是一个或多个R_OK(可读?), W_OK(可写?), X_OK(可执行?) 或 F_OK(文件存在?)组合体。</span> <br style="font-family:arial;text-align:left;"/>
<span style="font-family:arial;line-height:22px;text-align:left;">返回说明：</span> <span style="font-family:arial;line-height:22px;text-align:left;">成功执行时，返回0。失败返回-1，</span></span><br/>
</span></p>
<p><span style="font-family:Arial;line-height:26px;text-align:left;"><span style="font-size:18px;"><span style="font-family:arial;line-height:22px;text-align:left;">（5）umask（）函数：<span style="font-family:Arial;line-height:20px;">进程设置文件方式创建屏蔽字，即设置文件的权限,最大的权限是0777</span></span></span></span></p>
<p><span style="font-family:Arial;line-height:26px;text-align:left;"><span style="font-size:18px;"><span style="font-family:arial;line-height:22px;text-align:left;"><span style="font-family:Arial;line-height:20px;"><span style="font-family:Arial;line-height:20px;">#include
 &quot;sys/types.h&quot;</span><br style="line-height:20px;font-family:Arial;"/>
<span style="font-family:Arial;line-height:20px;">#include &quot;sys/stat.h&quot;</span><br style="line-height:20px;font-family:Arial;"/>
<span style="font-family:Arial;line-height:20px;">mode_t umask(mode_t cmask);</span><br style="line-height:20px;font-family:Arial;"/>
<span style="font-family:Arial;line-height:20px;">umask函数为进程设置文件方式创建屏蔽字。</span><br style="line-height:20px;font-family:Arial;"/>
<span style="font-family:Arial;line-height:20px;">unix中文件最大访问权限是0777, 即_rwxrwxrwx.</span><br style="line-height:20px;font-family:Arial;"/>
<span style="font-family:Arial;line-height:20px;">如果讲umask函数设置为0111, 那么用0777与0111(umask设置值)取异或操作得0666,即_rw_rw_rw.</span><br style="line-height:20px;font-family:Arial;"/>
<span style="font-family:Arial;line-height:20px;">当进程使用open或creat创建新文件时， 存取权限就是指定存取权限同0666的位与结果。</span><br style="line-height:20px;font-family:Arial;"/>
<span style="font-family:Arial;line-height:20px;">譬如下列代码:</span><br style="line-height:20px;font-family:Arial;"/>
<span style="font-family:Arial;line-height:20px;">umask(0111);</span><br style="line-height:20px;font-family:Arial;"/>
<span style="font-family:Arial;line-height:20px;">creat(&quot;newfile&quot;, 0777);</span><br style="line-height:20px;font-family:Arial;"/>
<span style="font-family:Arial;line-height:20px;">得到的newfile的存取权限仍然是0666，即0777&amp;0666=0666, 这就是umask的作用, 有点子网掩码的味道。</span><br/>
</span></span></span></span></p>
<p><span style="font-family:Arial;line-height:26px;text-align:left;"><span style="font-size:18px;"><span style="font-family:arial;line-height:22px;text-align:left;"><span style="font-family:Arial;line-height:20px;"><span style="font-family:Arial;line-height:20px;">（6）chmod（）和fchmod（）函数：用来更改文件的权限</span></span></span></span></span></p>
<p><span style="font-family:Arial;line-height:26px;text-align:left;"><span style="font-size:18px;"><span style="font-family:arial;line-height:22px;text-align:left;"><span style="font-family:Arial;line-height:20px;"><span style="font-family:Arial;line-height:20px;"><br/>
</span></span></span></span></span></p>
<p><span style="font-family:Arial;line-height:26px;text-align:left;"><span style="font-size:18px;"><span style="font-family:arial;line-height:22px;text-align:left;"><span style="font-family:Arial;line-height:20px;"><span style="font-family:Arial;line-height:20px;"><br/>
</span></span></span></span></span></p>
   
</div></div></div></div></div></div></div></div></div><br/></span>
</div></body></html> 